from matplotlib import pyplot as plt

# 4 clusters
nthreads = list(range(1,41))
texec = [4.7368, 2.6032, 1.8491, 1.6373, 1.3543, 1.2854, 1.1995, 1.0560, 0.9649, 0.9484, 0.8557, 0.8477, 0.8151, 0.7749, 0.7270, 0.7198, 0.6624, 0.6440, 0.6760, 0.6510, 0.6584, 0.6369, 0.6361, 0.6000, 0.5838, 0.5742, 0.5820, 0.5507, 0.5497, 0.5589, 0.5300, 0.5401, 0.5680, 0.5088, 0.5056, 0.5226, 0.5174, 0.4937, 0.4885, 0.4933]
terror = [0.0396, 0.0344, 0.0285, 0.0350, 0.0282, 0.0181, 0.0166, 0.0177, 0.0192, 0.0071, 0.0226, 0.0134, 0.0120, 0.0129, 0.0127, 0.0267, 0.0221, 0.0166, 0.0191, 0.0143, 0.0163, 0.0109, 0.0141, 0.0035, 0.0029, 0.0024, 0.0113, 0.0031, 0.0034, 0.0093, 0.0038, 0.0102, 0.0133, 0.0033, 0.0021, 0.0111, 0.0115, 0.0051, 0.0035, 0.0054]
cc = [15099474002, 15202354165, 15387224628, 15576608587, 15573314943, 15772382841, 15801127668, 15797581004, 15949766260, 16222528169, 16166142040, 16446337191, 16608687956, 16688227920, 17109602583, 17602387966, 18057337933, 18675458749, 19576024911, 19718660265, 20752902485, 21397742795, 21859884707, 22265324210, 22429568418, 23057557100, 23272395096, 23308242926, 23939972840, 24220014866, 24286008474, 24901727723, 25389793170, 24927889199, 25280926122, 25690778331, 26357028532, 25886100389, 26288372945, 26794745698]
cm = [5845894, 6689332, 7015360, 7308579, 7076440, 6520230, 6524772, 6908214, 7188248, 7497625, 7822917, 8018435, 8330461, 8389438, 8571260, 8698645, 8781838, 8980699, 9165476, 9202431, 9444812, 9506492, 9741554, 9854460, 10003215, 10323443, 10434607, 10530622, 10960587, 11102708, 11414324, 11994987, 12010052, 12230037, 12529316, 12885226, 13518313, 13529141, 13649887, 14258527]

# 16 clusters
nthreads2 = list(range(1,41))
texec2 = [10.6897, 5.6159, 3.9115, 3.1605, 2.6681, 2.3152, 2.0911, 1.8616, 1.7201, 1.5829, 1.4975, 1.3977, 1.3431, 1.2262, 1.1928, 1.1704, 1.0606, 1.0659, 1.0856, 1.1179, 1.1145, 1.1049, 1.0770, 1.0598, 1.0378, 1.0217, 0.9937, 0.9704, 0.9531, 0.9284, 0.9216, 0.8890, 0.8709, 0.8515, 0.8341, 0.8388, 0.8069, 0.8011, 0.7766, 0.7851]
terror2 = [0.0383, 0.0178, 0.0235, 0.0393, 0.0424, 0.0268, 0.0142, 0.0249, 0.0316, 0.0140, 0.0254, 0.0225, 0.0206, 0.0198, 0.0307, 0.0283, 0.0203, 0.0259, 0.0215, 0.0280, 0.0050, 0.0060, 0.0039, 0.0052, 0.0083, 0.0073, 0.0029, 0.0035, 0.0110, 0.0060, 0.0095, 0.0069, 0.0052, 0.0038, 0.0027, 0.0116, 0.0060, 0.0054, 0.0018, 0.0037]
cc2 = [34870574449, 34996338492, 35133782415, 35166669903, 35350570595, 35393029026, 35627661704, 35568125118, 35929371601, 35894619110, 36176789623, 36294895931, 36609893819, 36602489449, 37330181887, 37584946598, 37344634984, 38412053806, 39671404192, 41661719732, 42067121211, 43563495660, 44871839093, 46084986173, 47143236075, 48333180524, 49639077807, 50894835008, 52624589612, 52858132336, 53683543399, 54229513002, 55045909473, 55837084819, 56464056427, 57452556547, 57613789476, 58467843541, 58630014111, 59959870933]
cm2 = [8235991, 9143556, 9418565, 9725653, 9868973, 10059280, 10375772, 10537843, 10917946, 11274764, 11672378, 12020834, 11682185, 11548464, 11348768, 11517331, 11610722, 11689930, 11778965, 11881738, 12134028, 12303504, 12388424, 12604140, 12753001, 12906571, 13183794, 13339713, 13858117, 14116495, 14413217, 14636812, 14953587, 15172605, 15607418, 15939991, 16005850, 16341513, 16400908, 16955901]

# 32 clusters
nthreads3 = list(range(1,41))
texec3 = [17.2652, 8.9678, 6.1724, 4.8247, 3.9423, 3.4186, 2.9960, 2.6892, 2.4324, 2.2230, 2.1545, 2.0290, 1.8770, 1.6761, 1.6955, 1.6212, 1.5968, 1.3941, 1.6234, 1.6769, 1.6774, 1.7228, 1.6533, 1.6105, 1.5853, 1.5328, 1.4977, 1.4614, 1.4145, 1.3796, 1.3464, 1.3193, 1.2851, 1.2643, 1.2444, 1.2041, 1.1803, 1.1550, 1.1434, 1.1431]
terror3 = [0.0469, 0.0256, 0.0119, 0.0161, 0.0057, 0.0039, 0.0096, 0.0048, 0.0089, 0.0078, 0.0159, 0.0246, 0.0169, 0.0077, 0.0265, 0.0287, 0.0555, 0.0139, 0.0542, 0.0569, 0.0230, 0.0312, 0.0036, 0.0120, 0.0062, 0.0041, 0.0080, 0.0057, 0.0040, 0.0053, 0.0051, 0.0047, 0.0045, 0.0061, 0.0092, 0.0068, 0.0046, 0.0059, 0.0085, 0.0158]
cc3 = [56221278125, 56755916924, 56457114008, 56618533959, 56656639236, 56805460173, 56801153909, 57008802380, 56824374876, 57042964884, 57639886084, 57959335972, 58085877024, 57719698438, 58760812447, 58960660172, 59681623144, 58737128589, 62528651404, 63465305828, 66284212843, 68168916791, 70984371626, 73134456866, 75487389030, 79027664735, 78790212488, 80886458982, 82837785658, 84562525518, 86842568051, 88442138443, 89860513395, 91450499072, 92372418620, 94140068295, 95578966995, 96367590203, 97743231016, 99595494322]
cm3 = [8077900, 11571845, 8139783, 8137099, 8403414, 8454142, 8770586, 8904237, 9121351, 9501716, 13343211, 13433266, 13916310, 10426604, 14160478, 14137810, 14299236, 11020543, 14519711, 14148528, 14636779, 14778399, 15114470, 15165215, 15456874, 12403751, 15821473, 16172116, 16488686, 16725065, 17319220, 17570998, 17808668, 18253822, 18176685, 18668331, 19197297, 19040379, 19520831, 20047942]

nclusters = [4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64]
texecc = [0.6849, 0.8978, 1.1374, 1.2842, 1.4272, 1.6022, 1.8407, 1.9661, 2.0874, 2.2867, 2.5659, 2.6087, 2.7899, 2.9568, 3.2583, 3.2886]
terrorc = [0.0015, 0.0016, 0.0021, 0.0030, 0.0019, 0.0035, 0.0016, 0.0021, 0.0046, 0.0015, 0.0012, 0.0035, 0.0013, 0.0018, 0.0023, 0.0022]

texecc2 = [1.0209, 1.4411, 1.9171, 2.1459, 2.4971, 2.8359, 3.3127, 3.5101, 3.8504, 4.2197, 4.7697, 4.8949, 5.2303, 5.5645, 6.1707, 6.2396]
terrorc2 = [0.0065, 0.0022, 0.0032, 0.0037, 0.0059, 0.0041, 0.0062, 0.0049, 0.0034, 0.0063, 0.0075, 0.0075, 0.0079, 0.0090, 0.0082, 0.0092]


def make_plot(x, y, e, legend, xlabel, ylabel, xticks, yticks, fname, legendPos, title): 
    fig, ax = plt.subplots(figsize=(10, 5))
    colors = ['blue', 'green', 'orange', 'purple']

    if len(e) > 0:
        for i in range(len(x)):
            ax.errorbar(x[i], y[i], e[i], marker='.', ecolor='red', lw=0.75, c=colors[i])
    
    else:
        for i in range(len(x)):
            if legend[i] == 'Ideal Speedup':
                ax.plot(x[i], y[i], marker='', lw=0.75, c='grey', ls='--')
            else:    
                ax.plot(x[i], y[i], marker='.', lw=0.75, c=colors[i])
    
    ax.set_xlabel(xlabel)
    ax.set_ylabel(ylabel)
    # ax.legend(legend, loc=legendPos)

    ax.set_xticks(xticks)
    if len(yticks) > 0 :
        ax.set_yticks(yticks)

    # ax.set_ylim(ymin=0)
    # ax.set_xlim(xmin=0)

    #removing top and right borders
    ax.spines['top'].set_visible(False)
    ax.spines['right'].set_visible(False)

    #adds major gridlines
    ax.grid(color='grey', linestyle='-', linewidth=0.25, alpha=0.5)

    fig.tight_layout()

    if(title != ""):
        ax.set_title(title)

    plt.savefig(f'{fname}.png')
    plt.show()


speedup = []
speedup2 = []
speedup3 = []
for i in texec:
    speedup.append(texec[0] / i)
for i in texec2:
    speedup2.append(texec2[0] / i)
for i in texec3:
    speedup3.append(texec3[0] / i)

# make_plot([nthreads, nthreads2, nthreads3], [texec, texec2, texec3], [terror, terror2, terror3], ['4 clusters', '16 Clusters', '32 clusters'], 'Number of Threads', 'Execution Time (s)', [0] + nthreads, [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20], 'threadstime', 'upper right', "")
# make_plot([nclusters, nclusters], [texecc, texecc2], [terrorc, terrorc2], ['20 threads', '10 threads'],'Number of Clusters', 'Execution Time (s)', [0] + nclusters, [0, 1, 2, 3, 4, 5, 6], 'clusterstime', 'upper left', "")

# make_plot([nthreads, nthreads2, nthreads3, nthreads], [speedup, speedup2, speedup3, nthreads], [], ['4 clusters', '16 CLusters', '32 clusters', 'Ideal Speedup'], 'Number of Threads', 'Speedup', [0] + nthreads, [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40], 'speedup', 'upper left', "")

# make_plot([nthreads, nthreads2, nthreads3], [cc, cc2, cc3], [], ['4 clusters', '16 Clusters', '32 clusters'], 'Number of Threads', 'Clock Cycles', [0] + nthreads, [], 'cc', 'upper left', "")

# make_plot([nthreads, nthreads], [cm, cm2], [], ['4 clusters', '16 cluster'], 'Number of Threads', 'Cache Misses', [0] + nthreads, [], 'cm', 'upper left', "")

# cl = [4,8,16,32]

# calculate_clusters  = [83.64, 89.24, 92.89, 95.62]
# calculate_centroids = [8.54 , 5.56 , 3.61 , 2.32]
# random              = [5.76 , 3.92 , 2.63 , 0.92]
# init_ds             = [0.83 , 0.43 , 0.30 , 0.19]
# make_plot([cl, cl, cl], [calculate_clusters, calculate_centroids, random], [], ['calculate_clusters', 'calculate_centroids', 'random'], 'Number of Clusters', 'Computional Load (%)', [0] + cl, [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100], 'grafico1', 'center right', "1 Thread")

# calculate_clusters  = [82.74, 88.65, 92.41, 95.42]
# calculate_centroids = [9.05 , 5.83 , 3.83 , 2.32]
# random              = [5.90 , 3.87 , 2.61 , 1.49]
# init_ds             = [0.71 , 0.49 , 0.33 , 0.18]
# make_plot([cl, cl, cl], [calculate_clusters, calculate_centroids, random], [], ['calculate_clusters', 'calculate_centroids', 'random'], 'Number of Clusters', 'Computional Load (%)', [0] + cl, [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100], '2threads', 'center right', '2 Threads')

# calculate_clusters  = [78.18, 85.08, 89.99, 94.46]
# calculate_centroids = [12.84, 8.60 , 5.69 , 2.98]
# random              = [5.32 , 3.47 , 2.45 , 1.54]
# init_ds             = [0.63 , 0.41 , 0.28 , 0.19]
# make_plot([cl, cl, cl], [calculate_clusters, calculate_centroids, random], [], ['calculate_clusters', 'calculate_centroids', 'random'], 'Number of Clusters', 'Computional Load (%)', [0] + cl, [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100], '4threads', 'center right', '4 Threads')


npointst = [2000, 4000, 6000, 8000, 10000, 12000, 14000]
texect = [0.0023,  0.0033, 0.0043, 0.0054, 0.0062, 0.0073, 0.0083]
llcm = [42231, 71236, 90027, 109294, 129052, 148115, 167678]

npointst2 = [35000, 45000, 55000, 65000, 75000, 85000, 95000]
texect2 = [0.0230,  0.02907, 0.0351, 0.0412, 0.0473, 0.0534, 0.0594]
llcm2 = [506, 484, 748, 819, 862, 1111, 839]
error2 = [506 * 0.199, 484 * 0.067, 748 * 0.308, 819 * 0.283, 862 * 0.261, 1111 * 0.250, 839 * 0.103]

npointst3 = [1000000, 1100000, 1200000, 1300000, 1400000, 1500000, 1600000]
texect3 = [0.4742, 0.5238, 0.5686, 0.6161, 0.6653, 0.7129, 0.7774]
llcm3 = [7848, 15941, 20844, 30602, 50413, 79657, 144613]

print(((texect[-1] - texect[0])/(npointst[-1] - npointst[0])))
print(((texect2[-1] - texect2[0])/(npointst2[-1] - npointst2[0])))
print(((texect3[-1] - texect3[0])/(npointst3[-1] - npointst3[0])))

# make_plot([npointst], [texect], [], ['18 threads'], 'Number of Points', 'Execution Time', npointst, [], 'test', 'upper left', "")
# make_plot([npointst2], [texect2], [], ['18 threads'], 'Number of Points', 'Execution Time', npointst2, [], 'test2', 'upper left', "")
# make_plot([npointst3], [texect3], [], ['18 threads'], 'Number of Points', 'Execution Time', npointst3, [], 'test3', 'upper left', "")
# make_plot([npointst], [llcm], [], ['18 threads'], 'Number of Points', 'L1d Load Misses', npointst, [], 'cm1', 'upper left', "")
make_plot([npointst2], [llcm2], [error2], ['18 threads'], 'Number of Points', 'Cache Misses', npointst2, [], 'cm2', 'upper left', "")
# make_plot([npointst3], [llcm3], [], ['18 threads'], 'Number of Points', 'LLC Load Misses', npointst3, [], 'cm3', 'upper left', "")
